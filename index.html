<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تطبيق ذكي لتحليل الرسائل</title>
  <style>
    :root{
      --bg:#0f172a;           /* خلفية داكنة أنيقة */
      --panel:#111827;
      --card:#0b1220;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --primary:#22d3ee;      /* سماوي */
      --accent:#a78bfa;       /* بنفسجي فاتح */
      --success:#34d399;      /* أخضر */
      --danger:#f87171;       /* أحمر */
      --ring:#1f2937;
      --radius:14px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Kufi Arabic", "Tajawal", Arial, sans-serif;
      background: radial-gradient(1200px 800px at 80% -20%, #1b1b3a 0%, #0a0f1f 40%, #060913 100%), var(--bg);
      color:var(--text);
      display:flex;
      min-height:100vh;
    }

    /* تخطيط عام */
    .app{
      display:grid;
      grid-template-columns: 72px 1fr 280px; /* يسار (إغلاق) | المحتوى | القائمة اليمنى */
      grid-template-rows: auto 1fr auto;
      grid-template-areas:
        "left header header"
        "left main   sidebar"
        "left footer footer";
      width:100%;
      gap:16px;
      padding:16px;
    }

    /* شريط العنوان */
    header{
      grid-area:header;
      background:linear-gradient(90deg, rgba(34,211,238,.12), rgba(167,139,250,.12));
      border:1px solid #1f2937;
      border-radius:var(--radius);
      padding:16px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      backdrop-filter: blur(6px);
    }
    header h1{
      margin:0;
      font-size: clamp(18px, 2.2vw, 22px);
      letter-spacing:.2px;
    }

    /* شريط يسار - زر إغلاق */
    .left-rail{
      grid-area:left;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
    }
    .close-btn{
      width:100%;
      border:none;
      border-radius:var(--radius);
      padding:14px 10px;
      background:linear-gradient(180deg, #1f2937, #0b1220);
      color:var(--text);
      font-weight:600;
      cursor:pointer;
      border:1px solid #1f2937;
      transition: transform .12s ease, background .2s ease;
    }
    .close-btn:hover{ transform: translateY(-1px); background:#1b2431; }

    /* العمود الأيمن (الأزرار) */
    aside{
      grid-area:sidebar;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .menu-card{
      background:linear-gradient(180deg, var(--panel), var(--card));
      border:1px solid #1f2937;
      border-radius:var(--radius);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .tool-btn{
      width:100%;
      border:1px solid #263142;
      background:linear-gradient(180deg, #0f172a, #0b1220);
      color:var(--text);
      padding:12px 14px;
      border-radius:12px;
      font-weight:600;
      cursor:pointer;
      transition: transform .12s ease, border-color .15s ease, background .2s ease;
      text-align:center;
    }
    .tool-btn:hover{
      transform: translateY(-1px);
      border-color:#334155;
      background:#0e1628;
    }

    /* المحتوى الرئيسي */
    main{
      grid-area:main;
      display:grid;
      grid-template-rows: auto 1fr;
      gap:16px;
      min-height:0;
    }

    .search-bar{
      background:linear-gradient(180deg, var(--panel), var(--card));
      border:1px solid #1f2937;
      border-radius:var(--radius);
      padding:12px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .search-bar input{
      flex:1;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #263142;
      background:#0b1220;
      color:var(--text);
      outline:none;
    }
    .search-bar button{
      border:none;
      background:linear-gradient(90deg, var(--primary), var(--accent));
      color:#0b1020;
      font-weight:800;
      padding:12px 16px;
      border-radius:12px;
      cursor:pointer;
      transition: opacity .15s ease, transform .12s ease;
    }
    .search-bar button:hover{ opacity:.9; transform: translateY(-1px); }
    .search-bar button:disabled{
      opacity:.6; cursor:not-allowed;
    }

    .workspace{
      position:relative;
      background:linear-gradient(180deg, var(--panel), var(--card));
      border:1px solid #1f2937;
      border-radius:var(--radius);
      padding:16px;
      display:grid;
      place-items:center;
      overflow:hidden;
      min-height:360px;
    }

    /* عدّاد دائري (SVG) */
    .loader{
      width:210px; height:210px; position:relative; display:grid; place-items:center;
    }
    .loader svg{
      transform: rotate(-90deg);
      width:210px; height:210px;
      filter: drop-shadow(0 6px 16px rgba(34,211,238,.18));
    }
    .loader .bg{
      stroke:#1f2b3c; stroke-width:14; fill:none;
    }
    .loader .ring{
      stroke: url(#grad);
      stroke-linecap: round;
      stroke-width:14; fill:none;
      stroke-dasharray: 628;           /* تقريبا 2πr لـ r=100 */
      stroke-dashoffset: 628;
      animation: spin 1.6s linear infinite;
    }
    @keyframes spin{
      0%   { stroke-dasharray: 40 588; stroke-dashoffset: 0; }
      50%  { stroke-dasharray: 200 428; stroke-dashoffset: -80; }
      100% { stroke-dasharray: 40 588; stroke-dashoffset: -628; }
    }
    .loader .center{
      position:absolute;
      display:grid;
      place-items:center;
      text-align:center;
      gap:4px;
    }
    .loader .count{ font-size:28px; font-weight:800; }
    .loader .hint{ font-size:13px; color:var(--muted); }

    /* نتائج */
    .results{
      width:100%;
      max-width:900px;
      display:none;
      gap:10px;
    }
    .result{
      width:100%;
      border:1px solid #1f2937;
      background:#0b1220;
      border-radius:12px;
      padding:12px 14px;
    }

    /* الشريط السفلي (رصيد API) */
    footer{
      grid-area:footer;
      background:linear-gradient(180deg, var(--panel), var(--card));
      border:1px solid #1f2937;
      border-radius:var(--radius);
      padding:12px 16px;
      display:flex;
      align-items:center;
      gap:16px;
    }
    .meter{
      flex:1;
      height:12px;
      background:#0b1220;
      border:1px solid #263142;
      border-radius:999px;
      overflow:hidden;
      position:relative;
    }
    .meter .fill{
      height:100%;
      width:40%;               /* قيمة ابتدائية قابلة للتحديث */
      background:linear-gradient(90deg, var(--success), var(--primary));
      transition: width .3s ease;
    }
    .api-text{ min-width:max(140px, 20%); text-align:center; font-weight:700; }

    /* تجاوبية بسيطة */
    @media (max-width: 980px){
      .app{
        grid-template-columns: 56px 1fr;
        grid-template-rows: auto auto 1fr auto;
        grid-template-areas:
          "left header"
          "left sidebar"
          "left main"
          "left footer";
      }
      aside{ order: -1; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- يسار: زر إغلاق -->
    <div class="left-rail">
      <button class="close-btn" id="closeBtn">إغلاق</button>
    </div>

    <!-- شريط العنوان -->
    <header>
      <h1>تطبيق ذكي لتحليل الرسائل</h1>
      <div style="opacity:.75;font-size:14px">واجهة تجريبية</div>
    </header>

    <!-- المحتوى -->
    <main>
      <!-- بحث + زر عرض النتائج -->
      <div class="search-bar">
        <input id="query" type="text" placeholder="ابحث في الرسائل..." />
        <button id="searchBtn">عرض النتائج</button>
      </div>

      <!-- مساحة العمل: العدّاد الدائري + النتائج -->
      <section class="workspace">
        <div class="loader" id="loader" aria-live="polite" style="display:none">
          <svg viewBox="0 0 220 220" aria-hidden="true">
            <defs>
              <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%"  stop-color="#22d3ee"/>
                <stop offset="100%" stop-color="#a78bfa"/>
              </linearGradient>
            </defs>
            <circle class="bg"   cx="110" cy="110" r="100"></circle>
            <circle class="ring" cx="110" cy="110" r="100"></circle>
          </svg>
          <div class="center">
            <div class="count"><span id="count">0</span> نتيجة</div>
            <div class="hint">النظام يبحث عن النتائج…</div>
          </div>
        </div>

        <div class="results" id="results">
          <!-- تُملأ برمجياً -->
        </div>
      </section>
    </main>

    <!-- قائمة يمين: الأزرار الأربعة -->
    <aside>
      <div class="menu-card">
        <button class="tool-btn" id="btnDecrypt">تحميل ملفات الواتساب</button>
        <button class="tool-btn" id="btnAI">فك التشفير</button>
        <button class="tool-btn" id="btnAI1">فرز والتهيئة</button>
        <button class="tool-btn" id="btnSupplyDemand">تحليل الذكاء الاصطناعي</button>
        <button class="tool-btn" id="btnOpportunities">البحث عن فرص</button>
        <button class="tool-btn" id="btnPage5">اظافي</button>
      </div>
    </aside>

    <!-- شريط سفلي: رصيد API -->
    <footer>
      <div class="api-text">رصيد GPT API المتبقي: <span id="apiPct">40%</span></div>
      <div class="meter" aria-hidden="true"><div class="fill" id="apiFill"></div></div>
    </footer>
  </div>

  <script>
    // عناصر DOM
    const searchBtn = document.getElementById('searchBtn');
    const queryEl   = document.getElementById('query');
    const loader    = document.getElementById('loader');
    const results   = document.getElementById('results');
    const countEl   = document.getElementById('count');
    const apiPctEl  = document.getElementById('apiPct');
    const apiFillEl = document.getElementById('apiFill');
    const closeBtn  = document.getElementById('closeBtn');

    // رصيد API الابتدائي (يمكن ربطه لاحقاً بالقيمة الحقيقية من خادمك)
    let apiPercent = 40;

    // محاكاة بحث: يزيد العدّاد بشكل دائري ثم يُظهر النتائج
    function simulateSearch(term){
      results.style.display = 'none';
      loader.style.display  = 'grid';
      searchBtn.disabled    = true;

      let count = 0;
      countEl.textContent = '0';

      // مؤقّت تحديث العدّاد
      const tick = setInterval(()=>{
        count += Math.floor(Math.random()*5)+1; // زيادة عشوائية لطيفة
        if(count > 97) count = 97;              // نترك 3% للنهاية
        countEl.textContent = count.toString();
      }, 140);

      // زمن البحث الوهمي (2.8 - 4.2 ثانية)
      const duration = 2800 + Math.random()*1400;
      setTimeout(()=>{
        clearInterval(tick);
        // ننهي العد إلى قيمة نهائية
        const finalCount = 120 + Math.floor(Math.random()*40); // عدد نتائج افتراضي
        countEl.textContent = finalCount.toString();

        // توليد بطاقات نتائج وهمية
        renderResults(term, finalCount);

        // إخفاء العدّاد وإظهار النتائج
        loader.style.display  = 'none';
        results.style.display = 'grid';
        searchBtn.disabled    = false;

        // خصم بسيط من رصيد API لكل عملية
        decreaseApi(3 + Math.floor(Math.random()*3));
      }, duration);
    }

    function renderResults(term, n){
      results.innerHTML = '';
      results.style.gridTemplateColumns = '1fr';
      for(let i=1;i<=Math.min(n,8);i++){
        const card = document.createElement('div');
        card.className = 'result';
        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;">
            <strong>نتيجة #${i}</strong>
            <span style="color:#94a3b8;font-size:12px">تحليل أولي</span>
          </div>
          <div style="margin-top:6px;color:#cbd5e1">
            ${term ? `مطابقة لعبارة البحث: <em style="font-style:normal;color:#a5b4fc">"${escapeHtml(term)}"</em>.` : 'نموذج نتيجة بدون عبارة بحث.'}
            هذا نص تمثيلي لمعاينة شكل النتائج داخل النظام.
          </div>
        `;
        results.appendChild(card);
      }
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[m]));
    }

    // تحديث شريط رصيد API
    function setApi(percent){
      apiPercent = Math.max(0, Math.min(100, percent));
      apiPctEl.textContent = apiPercent + '%';
      apiFillEl.style.width = apiPercent + '%';
      apiFillEl.style.background = apiPercent < 15
        ? 'linear-gradient(90deg, var(--danger), #f59e0b)'
        : 'linear-gradient(90deg, var(--success), var(--primary))';
    }
    function decreaseApi(delta){ setApi(apiPercent - delta); }

    // إجراءات الأزرار
    searchBtn.addEventListener('click', () => simulateSearch(queryEl.value.trim()));
    queryEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') searchBtn.click(); });

    document.getElementById('btnDecrypt').addEventListener('click', () => window.location.href = 'page1.html');
    document.getElementById('btnAI').addEventListener('click', () => window.location.href = 'page2.html');
    document.getElementById('btnAI1').addEventListener('click', () => window.location.href = 'page6.html');
    document.getElementById('btnSupplyDemand').addEventListener('click', () => window.location.href = 'page3.html');
    document.getElementById('btnOpportunities').addEventListener('click', () => window.location.href = 'page4.html');
    document.getElementById('btnPage5').addEventListener('click', () => window.location.href = 'page5.html');

    closeBtn.addEventListener('click', () => {
      // نحاول إغلاق النافذة؛ وإن لم يسمح المتصفح، نُخفي الواجهة
      if(window.close) window.close();
      document.querySelector('.app').style.display = 'none';
      document.body.innerHTML = '<div style="display:grid;place-items:center;height:100vh;color:#e5e7eb;font-family:inherit">تم الإغلاق</div>';
    });

    // تهيئة
    setApi(apiPercent);
  </script>
</body>
</html>
