<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ù„ØµÙØ­Ø© 2</title>
<style>
  :root {
    --bg: #0f172a;
    --card: #111827;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --accent: #22c55e;
    --accent-2: #3b82f6;
    --btn-bg: #1f2937;
    --btn-hover: #374151;
    --shadow: 0 10px 25px rgba(0,0,0,.35);
    --radius: 18px;
    --danger: #ef4444;
    --danger-hover: #dc2626;
  }
  * { box-sizing: border-box; }
  html, body {
    margin: 0; padding: 0; background: var(--bg); color: var(--text);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Naskh Arabic", Arial, sans-serif;
  }
  .wrap { min-height: 100vh; display: grid; place-items: center; padding: 24px; }
  .card {
    width: min(920px, 96vw); background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius); padding: 28px; box-shadow: var(--shadow);
    backdrop-filter: blur(6px);
  }
  h1 { margin: 0 0 10px; font-size: clamp(26px, 3.5vw, 40px); letter-spacing: .2px; }
  p.lead { margin: 0 0 26px; color: var(--muted); }
  .grid {
    display: grid; gap: 14px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }
  a.btn, button.btn {
    display: inline-block; text-decoration: none; text-align: center; cursor: pointer;
    background: var(--btn-bg); color: var(--text); padding: 14px 16px;
    border-radius: 14px; border: 1px solid rgba(255,255,255,.08);
    transition: transform .12s ease, background .12s ease, border-color .12s ease;
    box-shadow: 0 6px 14px rgba(0,0,0,.25);
    font-family: inherit; font-size: inherit;
  }
  a.btn:hover, button.btn:hover { background: var(--btn-hover); transform: translateY(-1px); }
  a.btn.primary, button.btn.primary { background: var(--accent-2); border-color: transparent; color: #fff; }
  .btn.success { background: var(--accent); border-color: transparent; color: #fff; }
  .btn.danger { background: var(--danger); border-color: transparent; color: #fff; }
  .btn.danger:hover { background: var(--danger-hover); }
  
  .files-section {
    margin: 24px 0;
  }
  
  .stats-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 16px;
    background: rgba(255,255,255,.02);
    border-radius: var(--radius);
    flex-wrap: wrap;
    gap: 12px;
  }
  
  .stat-item {
    text-align: center;
  }
  
  .stat-number {
    font-size: 24px;
    font-weight: bold;
    color: var(--accent-2);
  }
  
  .stat-label {
    font-size: 12px;
    color: var(--muted);
  }
  
  .search-bar {
    margin-bottom: 20px;
  }
  
  .search-input {
    width: 100%;
    padding: 12px 16px;
    background: var(--btn-bg);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: 10px;
    color: var(--text);
    font-family: inherit;
    font-size: 14px;
  }
  
  .search-input:focus {
    outline: none;
    border-color: var(--accent-2);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, .1);
  }
  
  .filter-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  .filter-tab {
    padding: 8px 16px;
    background: var(--btn-bg);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: 20px;
    cursor: pointer;
    transition: all .2s ease;
    font-size: 12px;
  }
  
  .filter-tab.active {
    background: var(--accent-2);
    border-color: var(--accent-2);
    color: #fff;
  }
  
  .filter-tab:hover {
    background: var(--btn-hover);
  }
  
  .files-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
  }
  
  .file-card {
    background: rgba(255,255,255,.02);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius);
    padding: 16px;
    transition: all .2s ease;
  }
  
  .file-card:hover {
    background: rgba(255,255,255,.04);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }
  
  .file-header {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
  }
  
  .file-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    margin-left: 12px;
  }
  
  .file-icon.image { background: linear-gradient(45deg, #10b981, #059669); }
  .file-icon.document { background: linear-gradient(45deg, #3b82f6, #1d4ed8); }
  .file-icon.audio { background: linear-gradient(45deg, #8b5cf6, #7c3aed); }
  .file-icon.video { background: linear-gradient(45deg, #ef4444, #dc2626); }
  .file-icon.archive { background: linear-gradient(45deg, #f59e0b, #d97706); }
  .file-icon.other { background: linear-gradient(45deg, #6b7280, #4b5563); }
  
  .file-info {
    flex: 1;
  }
  
  .file-name {
    font-weight: 500;
    color: var(--text);
    margin-bottom: 4px;
    word-break: break-word;
  }
  
  .file-meta {
    font-size: 12px;
    color: var(--muted);
  }
  
  .file-preview {
    margin: 12px 0;
    text-align: center;
  }
  
  .file-preview img {
    max-width: 100%;
    max-height: 120px;
    border-radius: 8px;
    object-fit: cover;
  }
  
  .file-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
  }
  
  .btn-small {
    padding: 6px 12px;
    font-size: 12px;
    flex: 1;
  }
  
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }
  
  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  
  .status-message {
    margin: 16px 0;
    padding: 12px;
    border-radius: 10px;
    text-align: center;
  }
  
  .status-success {
    background: rgba(34, 197, 94, .1);
    color: var(--accent);
    border: 1px solid rgba(34, 197, 94, .2);
  }
  
  .status-error {
    background: rgba(239, 68, 68, .1);
    color: var(--danger);
    border: 1px solid rgba(239, 68, 68, .2);
  }
  
  .status-info {
    background: rgba(59, 130, 246, .1);
    color: var(--accent-2);
    border: 1px solid rgba(59, 130, 246, .2);
  }
  
  .hidden {
    display: none;
  }
  
  footer { margin-top: 18px; color: var(--muted); font-size: 13px; }
</style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Ø§Ù„ØµÙØ­Ø© 2</h1>
      <p class="lead">Ù‡Ø°Ù‡ ØµÙØ­Ø© Ø§Ù„ØµÙØ­Ø© 2 - Ù…Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©.</p>
      
      <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-number" id="total-files">0</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª</div>
          <div class="filter-tab" onclick="filterFiles('other')">ğŸ“ Ø£Ø®Ø±Ù‰</div>
      </div>
        <div class="stat-item">
          <div class="stat-number" id="total-size">0</div>
          <div class="stat-label">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="file-types">0</div>
          <div class="stat-label">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª</div>
        </div>
      </div>
      
      <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø© -->
      <div id="status-message" class="hidden"></div>
      
      <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
      <div class="search-bar">
        <input 
          type="text" 
          class="search-input" 
          id="search-input" 
          placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª..."
          oninput="searchFiles()"
        />
      </div>
      
      <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙÙ„ØªØ± -->
      <div class="filter-tabs">
        <div class="filter-tab active" onclick="filterFiles('all')">Ø§Ù„ÙƒÙ„</div>
        <div class="filter-tab" onclick="filterFiles('image')">ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±</div>
        <div class="filter-tab" onclick="filterFiles('document')">ğŸ“„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</div>
        <div class="filter-tab" onclick="filterFiles('audio')">ğŸµ Ø§Ù„ØµÙˆØªÙŠØ§Øª</div>
        <div class="filter-tab" onclick="filterFiles('video')">ğŸ¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</div>
        <div class="filter-tab" onclick="filterFiles('archive')">ğŸ“¦ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</div>
      </div>
      
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù„ÙØ§Øª -->
      <div class="files-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
          <div>
            <button class="btn btn-small" onclick="refreshFiles()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            <button class="btn success btn-small" onclick="selectAll()">âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
            <button class="btn danger btn-small" onclick="deleteSelected()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
          </div>
        </div>
        
        <div id="files-container" class="files-grid">
          <!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ -->
        </div>
      </div>
      
      <a class="btn primary" href="index.html">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      
      <footer>
        <p>ğŸ“‚ <strong>Ù…Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª:</strong> Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© 1</p>
      </footer>
    </div>
  </div>

  <script>
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    const DB_NAME = 'FilesStorage';
    const DB_VERSION = 1;
    const STORE_NAME = 'files';
    
    let db;
    let allFiles = [];
    let filteredFiles = [];
    let currentFilter = 'all';
    let selectedFiles = new Set();
    
    // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function initDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          db = request.result;
          resolve(db);
        };
        
        request.onupgradeneeded = (event) => {
          db = event.target.result;
          if (!db.objectStoreNames.contains(STORE_NAME)) {
            const store = db.createObjectStore(STORE_NAME, { keyPath: 'id' });
            store.createIndex('name', 'name', { unique: false });
            store.createIndex('uploadTime', 'uploadTime', { unique: false });
          }
        };
      });
    }
    
    // Ù‚Ø±Ø§Ø¡Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
    function getAllFiles() {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readonly');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.getAll();
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }
    
    // Ø­Ø°Ù Ù…Ù„Ù
    function deleteFile(id) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.delete(id);
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
    function getFileType(mimeType, fileName) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø©
      if (fileName && (
          fileName.toLowerCase().endsWith('.zip') ||
          fileName.toLowerCase().endsWith('.rar') ||
          fileName.toLowerCase().endsWith('.7z') ||
          fileName.toLowerCase().endsWith('.tar') ||
          fileName.toLowerCase().endsWith('.gz')
      )) {
        return 'archive';
      }
      
      if (mimeType.startsWith('image/')) return 'image';
      if (mimeType.startsWith('video/')) return 'video';
      if (mimeType.startsWith('audio/')) return 'audio';
      if (mimeType.includes('pdf') || mimeType.includes('document') || 
          mimeType.includes('text') || mimeType.includes('sheet') ||
          mimeType.includes('presentation')) return 'document';
      if (mimeType.includes('zip') || mimeType.includes('rar') || 
          mimeType.includes('archive')) return 'archive';
      return 'other';
    }
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
    function getFileIcon(type) {
      const icons = {
        image: 'ğŸ–¼ï¸',
        video: 'ğŸ¬',
        audio: 'ğŸµ',
        document: 'ğŸ“„',
        archive: 'ğŸ“¦',
        other: 'ğŸ“'
      };
      return icons[type] || 'ğŸ“';
    }
    
    // ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
    async function extractArchive(fileId) {
      try {
        const file = allFiles.find(f => f.id === fileId);
        if (!file) {
          showMessage('âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
          return;
        }
        
        console.log('Extracting file:', file.name, 'Type:', file.type);
        showMessage('ğŸ“¦ Ø¬Ø§Ø±ÙŠ ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù...', 'info');
        
        // ØªØ­ÙˆÙŠÙ„ base64 Ø¥Ù„Ù‰ ArrayBuffer
        let base64Data;
        if (file.data.includes(',')) {
          base64Data = file.data.split(',')[1];
        } else {
          base64Data = file.data;
        }
        
        const binaryString = atob(base64Data);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        
        console.log('Binary data prepared, size:', bytes.length);
        
        // ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… JSZip
        const zip = await JSZip.loadAsync(bytes);
        console.log('Zip loaded successfully');
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª
        const extractedFiles = [];
        for (const [filename, fileObj] of Object.entries(zip.files)) {
          if (!fileObj.dir) {
            try {
              const content = await fileObj.async('text');
              extractedFiles.push({
                name: filename,
                content: content,
                size: content.length
              });
              console.log('Extracted file:', filename, 'Size:', content.length);
            } catch (e) {
              console.error('Error extracting file:', filename, e);
            }
          }
        }
        
        if (extractedFiles.length === 0) {
          showMessage('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ', 'error');
          return;
        }
        
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
        displayExtractedFiles(file, extractedFiles);
        showMessage(`âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${extractedFiles.length} Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ`, 'success');
        
      } catch (error) {
        console.error('Error extracting archive:', error);
        showMessage('âŒ ÙØ´Ù„ ÙÙŠ ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù: ' + error.message, 'error');
      }
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
    function displayExtractedFiles(archiveFile, extractedFiles) {
      const archiveCard = document.querySelector(`[data-file-id="${archiveFile.id}"]`);
      if (!archiveCard) return;
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
      const existingContent = archiveCard.querySelector('.archive-content');
      if (existingContent) {
        existingContent.remove();
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
      const contentDiv = document.createElement('div');
      contentDiv.className = 'archive-content';
      
      extractedFiles.forEach(file => {
        const fileDiv = document.createElement('div');
        fileDiv.className = 'archive-file';
        
        fileDiv.innerHTML = `
          <span class="archive-file-name">ğŸ“„ ${file.name}</span>
          <span class="archive-file-size">${formatFileSize(file.size)}</span>
          <button class="archive-file-extract" onclick="saveExtractedFile('${archiveFile.id}', '${file.name}')">
            ğŸ’¾ Ø­ÙØ¸
          </button>
          <button class="archive-file-extract" onclick="viewExtractedFile('${archiveFile.id}', '${file.name}')" style="background: #10b981;">
            ğŸ‘ï¸ Ø¹Ø±Ø¶
          </button>
        `;
        
        contentDiv.appendChild(fileDiv);
      });
      
      // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù„Ù
      archiveCard.appendChild(contentDiv);
      
      // Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
      if (!window.extractedFilesCache) {
        window.extractedFilesCache = {};
      }
      window.extractedFilesCache[archiveFile.id] = extractedFiles;
    }
    
    // Ø­ÙØ¸ Ù…Ù„Ù Ù…Ø³ØªØ®Ø±Ø¬ ÙƒÙ…Ù„Ù Ø¬Ø¯ÙŠØ¯
    async function saveExtractedFile(archiveId, fileName) {
      try {
        const extractedFiles = window.extractedFilesCache[archiveId];
        if (!extractedFiles) {
          showMessage('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©', 'error');
          return;
        }
        
        const file = extractedFiles.find(f => f.name === fileName);
        if (!file) {
          showMessage('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù', 'error');
          return;
        }
        
        // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙˆÙ…Ø­ØªÙˆØ§Ù‡
        let mimeType = 'text/plain';
        let processedContent = file.content;
        
        if (fileName.endsWith('.json')) {
          mimeType = 'application/json';
          // ØªÙ†Ø³ÙŠÙ‚ JSON Ø¥Ø°Ø§ ÙƒØ§Ù† ØµØ§Ù„Ø­Ø§Ù‹
          try {
            const jsonData = JSON.parse(file.content);
            processedContent = JSON.stringify(jsonData, null, 2);
          } catch (e) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† JSON ØµØ§Ù„Ø­ØŒ Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£ØµÙ„ÙŠ
          }
        } else if (fileName.endsWith('.txt')) {
          mimeType = 'text/plain';
        }
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ base64
        const base64Content = btoa(unescape(encodeURIComponent(processedContent)));
        const dataUrl = `data:${mimeType};base64,${base64Content}`;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const newFileData = {
          id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          name: fileName,
          size: new Blob([processedContent]).size,
          type: mimeType,
          data: dataUrl,
          uploadTime: new Date().toLocaleString('ar-SA'),
          timestamp: Date.now(),
          extractedFrom: archiveId
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await saveFile(newFileData);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        await loadFiles();
        
        showMessage(`âœ… ØªÙ… Ø­ÙØ¸ ${fileName} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        
      } catch (error) {
        console.error('Error saving extracted file:', error);
        showMessage('âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù', 'error');
      }
    }
    
    // Ø¹Ø±Ø¶ Ù…Ù„Ù Ù…Ø³ØªØ®Ø±Ø¬
    function viewExtractedFile(archiveId, fileName) {
      try {
        const extractedFiles = window.extractedFilesCache[archiveId];
        if (!extractedFiles) {
          showMessage('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©', 'error');
          return;
        }
        
        const file = extractedFiles.find(f => f.name === fileName);
        if (!file) {
          showMessage('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù', 'error');
          return;
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        const newWindow = window.open('', '_blank');
        newWindow.document.write(`
          <html dir="rtl">
            <head>
              <title>${fileName}</title>
              <meta charset="utf-8">
              <style>
                body {
                  font-family: 'Courier New', monospace;
                  background: #1e293b;
                  color: #e2e8f0;
                  padding: 20px;
                  margin: 0;
                  line-height: 1.6;
                }
                .header {
                  background: #334155;
                  padding: 15px;
                  border-radius: 8px;
                  margin-bottom: 20px;
                  border-left: 4px solid #3b82f6;
                }
                .content {
                  background: #0f172a;
                  padding: 20px;
                  border-radius: 8px;
                  white-space: pre-wrap;
                  max-height: 80vh;
                  overflow-y: auto;
                  border: 1px solid #374151;
                }
                .json-key { color: #60a5fa; }
                .json-string { color: #34d399; }
                .json-number { color: #fbbf24; }
                .json-boolean { color: #f87171; }
                h1, h2, h3 { color: #60a5fa; }
                .stats { color: #10b981; }
                .section { border-left: 3px solid #3b82f6; padding-left: 10px; margin: 10px 0; }
              </style>
            </head>
            <body>
              <div class="header">
                <h2>ğŸ“„ ${fileName}</h2>
                <p>Ø§Ù„Ø­Ø¬Ù…: ${formatFileSize(file.content.length)} | Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø£Ø±Ø´ÙŠÙ</p>
              </div>
              <div class="content">${formatFileContent(file.content, fileName)}</div>
            </body>
          </html>
        `);
        newWindow.document.close();
        
      } catch (error) {
        console.error('Error viewing extracted file:', error);
        showMessage('âŒ ÙØ´Ù„ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù', 'error');
      }
    }
    
    // ØªÙ†Ø³ÙŠÙ‚ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹Ù‡
    function formatFileContent(content, fileName) {
      if (fileName.endsWith('.json')) {
        try {
          const jsonData = JSON.parse(content);
          return syntaxHighlightJson(jsonData);
        } catch (e) {
          return escapeHtml(content);
        }
      } else if (fileName.endsWith('.txt')) {
        // ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†ØµÙŠØ©
        if (content.includes('ğŸ“Š ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ù‚Ø±ÙˆØ¨')) {
          return formatReportContent(content);
        }
        return escapeHtml(content);
      }
      return escapeHtml(content);
    }
    
    // ØªÙ…ÙŠÙŠØ² ØµÙŠØºØ© JSON
    function syntaxHighlightJson(obj) {
      const json = JSON.stringify(obj, null, 2);
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        let cls = 'json-number';
        if (/^"/.test(match)) {
          if (/:$/.test(match)) {
            cls = 'json-key';
          } else {
            cls = 'json-string';
          }
        } else if (/true|false/.test(match)) {
          cls = 'json-boolean';
        } else if (/null/.test(match)) {
          cls = 'json-boolean';
        }
        return '<span class="' + cls + '">' + match + '</span>';
      });
    }
    
    // ØªÙ†Ø³ÙŠÙ‚ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
    function formatReportContent(content) {
      return content
        .replace(/ğŸ“Š ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ù‚Ø±ÙˆØ¨:(.+)/g, '<h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ù‚Ø±ÙˆØ¨:$1</h1>')
        .replace(/================================================================================/g, '<hr style="border: 1px solid #374151;">')
        .replace(/ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬:(.+)/g, '<div class="stats">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬:$1</div>')
        .replace(/ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:(.+)/g, '<div class="stats">ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:$1</div>')
        .replace(/âœ¨ Ø±Ø³Ø§Ø¦Ù„ ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:(.+)/g, '<div class="stats">âœ¨ Ø±Ø³Ø§Ø¦Ù„ ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:$1</div>')
        .replace(/ğŸ“± Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù…:(.+)/g, '<div class="stats">ğŸ“± Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù…:$1</div>')
        .replace(/ğŸ’° Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø³Ø¹Ø§Ø±:(.+)/g, '<div class="stats">ğŸ’° Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø³Ø¹Ø§Ø±:$1</div>')
        .replace(/ğŸ” Ø±Ø³Ø§Ø¦Ù„ Ù…Ø·Ù„ÙˆØ¨:(.+)/g, '<div class="stats">ğŸ” Ø±Ø³Ø§Ø¦Ù„ Ù…Ø·Ù„ÙˆØ¨:$1</div>')
        .replace(/ğŸ  Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹Ø±ÙˆØ¶:(.+)/g, '<div class="stats">ğŸ  Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹Ø±ÙˆØ¶:$1</div>')
        .replace(/ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:/g, '<h2>ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</h2>')
        .replace(/ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:/g, '<h2>ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:</h2>')
        .replace(/Ø±Ø³Ø§Ù„Ø© Ø±Ù‚Ù… (\d+):/g, '<h3 class="section">Ø±Ø³Ø§Ù„Ø© Ø±Ù‚Ù… $1:</h3>')
        .replace(/ğŸ‘¤ Ø§Ù„Ù…Ø±Ø³Ù„:(.+)/g, '<div>ğŸ‘¤ Ø§Ù„Ù…Ø±Ø³Ù„:$1</div>')
        .replace(/ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø³Ù„:(.+)/g, '<div>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø³Ù„:$1</div>')
        .replace(/ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:(.+)/g, '<div>ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:$1</div>')
        .replace(/ğŸ§  ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:(.+)/g, '<div>ğŸ§  ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:$1</div>')
        .replace(/ğŸ“ Ø£Ø±Ù‚Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ©:(.+)/g, '<div>ğŸ“ Ø£Ø±Ù‚Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ©:$1</div>')
        .replace(/ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:(.+)/g, '<div>ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:$1</div>')
        .replace(/ğŸ—ºï¸ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:(.+)/g, '<div>ğŸ—ºï¸ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:$1</div>')
        .replace(/ğŸ  Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±:(.+)/g, '<div>ğŸ  Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±:$1</div>')
        .replace(/ğŸ“„ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:/g, '<div style="margin-top: 10px;"><strong>ğŸ“„ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong></div>')
        .replace(/==================================================/g, '<hr style="border: 1px dashed #374151; margin: 20px 0;">')
        .replace(/------------------------------------------/g, '<hr style="border: 1px dotted #374151; margin: 15px 0;">')
        .replace(/â€¢(.+)/g, '<div style="margin-left: 20px;">â€¢$1</div>');
    }
    
    // Ù‡Ø±ÙˆØ¨ HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø©
    function showMessage(message, type) {
      const statusDiv = document.getElementById('status-message');
      statusDiv.textContent = message;
      statusDiv.className = `status-message status-${type}`;
      statusDiv.classList.remove('hidden');
      
      setTimeout(() => {
        statusDiv.classList.add('hidden');
      }, 4000);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function updateStats() {
      const totalFiles = allFiles.length;
      const totalSize = allFiles.reduce((sum, file) => sum + file.size, 0);
      const fileTypes = new Set(allFiles.map(file => getFileType(file.type, file.name))).size;
      
      document.getElementById('total-files').textContent = totalFiles;
      document.getElementById('total-size').textContent = formatFileSize(totalSize);
      document.getElementById('file-types').textContent = fileTypes;
    }
    
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
    function filterFiles(type) {
      currentFilter = type;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
      document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
      if (type === 'all') {
        filteredFiles = [...allFiles];
      } else {
        filteredFiles = allFiles.filter(file => getFileType(file.type, file.name) === type);
      }
      
      displayFiles();
    }
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª
    function searchFiles() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      
      let baseFiles = currentFilter === 'all' ? allFiles : 
                     allFiles.filter(file => getFileType(file.type, file.name) === currentFilter);
      
      if (searchTerm) {
        filteredFiles = baseFiles.filter(file => 
          file.name.toLowerCase().includes(searchTerm)
        );
      } else {
        filteredFiles = [...baseFiles];
      }
      
      displayFiles();
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª
    function displayFiles() {
      const container = document.getElementById('files-container');
      
      if (filteredFiles.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“‚</div>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª</h3>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
            <a href="page1.html" class="btn primary">Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</a>
          </div>
        `;
        return;
      }
      
      const fileCards = filteredFiles.map(file => {
        const fileType = getFileType(file.type);
        const fileIcon = getFileIcon(fileType);
        const isSelected = selectedFiles.has(file.id);
        
        let preview = '';
        if (fileType === 'image') {
          preview = `
            <div class="file-preview">
              <img src="${file.data}" alt="${file.name}" onclick="viewFile('${file.id}')">
            </div>
          `;
        }
        
        return `
          <div class="file-card ${isSelected ? 'selected' : ''}" data-file-id="${file.id}">
            <div class="file-header">
              <div class="file-icon ${fileType}">${fileIcon}</div>
              <div class="file-info">
                <div class="file-name">${file.name}</div>
                <div class="file-meta">${formatFileSize(file.size)} â€¢ ${file.uploadTime}</div>
              </div>
              <input type="checkbox" ${isSelected ? 'checked' : ''} 
                     onchange="toggleFileSelection('${file.id}')" 
                     style="margin-right: 8px;">
            </div>
            
            ${preview}
            
            <div class="file-actions">
              <button class="btn btn-small" onclick="downloadFile('${file.id}')">
                â¬‡ï¸ ØªØ­Ù…ÙŠÙ„
              </button>
              <button class="btn btn-small" onclick="viewFile('${file.id}')">
                ğŸ‘ï¸ Ø¹Ø±Ø¶
              </button>
              <button class="btn danger btn-small" onclick="deleteFileConfirm('${file.id}')">
                ğŸ—‘ï¸ Ø­Ø°Ù
              </button>
            </div>
          </div>
        `;
      }).join('');
      
      container.innerHTML = fileCards;
    }
    
    // ØªØ­Ø¯ÙŠØ¯/Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…Ù„Ù
    function toggleFileSelection(fileId) {
      if (selectedFiles.has(fileId)) {
        selectedFiles.delete(fileId);
      } else {
        selectedFiles.add(fileId);
      }
      displayFiles();
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
    function selectAll() {
      if (selectedFiles.size === filteredFiles.length) {
        selectedFiles.clear();
      } else {
        selectedFiles.clear();
        filteredFiles.forEach(file => selectedFiles.add(file.id));
      }
      displayFiles();
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù
    async function downloadFile(fileId) {
      try {
        const file = allFiles.find(f => f.id === fileId);
        if (!file) {
          showMessage('âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
          return;
        }
        
        const a = document.createElement('a');
        a.href = file.data;
        a.download = file.name;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        showMessage(`â¬‡ï¸ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${file.name}`, 'success');
      } catch (error) {
        showMessage('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù', 'error');
      }
    }
    
    // Ø¹Ø±Ø¶ Ù…Ù„Ù
    async function viewFile(fileId) {
      try {
        const file = allFiles.find(f => f.id === fileId);
        if (!file) {
          showMessage('âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
          return;
        }
        
        const newWindow = window.open();
        const fileType = getFileType(file.type);
        
        if (fileType === 'image') {
          newWindow.document.write(`
            <html dir="rtl">
              <head><title>${file.name}</title></head>
              <body style="margin: 0; background: #000; display: flex; align-items: center; justify-content: center; min-height: 100vh;">
                <img src="${file.data}" style="max-width: 100%; max-height: 100%; object-fit: contain;" alt="${file.name}">
              </body>
            </html>
          `);
        } else {
          newWindow.location.href = file.data;
        }
      } catch (error) {
        showMessage('âŒ ÙØ´Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù', 'error');
      }
    }
    
    // ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù…Ù„Ù
    function deleteFileConfirm(fileId) {
      const file = allFiles.find(f => f.id === fileId);
      if (!file) return;
      
      if (confirm(`ğŸ—‘ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${file.name}ØŸ`)) {
        deleteFileById(fileId);
      }
    }
    
    // Ø­Ø°Ù Ù…Ù„Ù Ø¨Ø§Ù„Ù…Ø¹Ø±Ù
    async function deleteFileById(fileId) {
      try {
        await deleteFile(fileId);
        await loadFiles();
        showMessage('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
      } catch (error) {
        showMessage('âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù', 'error');
      }
    }
    
    // Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    async function deleteSelected() {
      if (selectedFiles.size === 0) {
        showMessage('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù…Ù„ÙØ§Øª', 'error');
        return;
      }
      
      if (!confirm(`ğŸ—‘ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selectedFiles.size} Ù…Ù„ÙØŸ`)) {
        return;
      }
      
      try {
        for (const fileId of selectedFiles) {
          await deleteFile(fileId);
        }
        selectedFiles.clear();
        await loadFiles();
        showMessage(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­`, 'success');
      } catch (error) {
        showMessage('âŒ ÙØ´Ù„ Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª', 'error');
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
    async function refreshFiles() {
      await loadFiles();
      showMessage('ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª', 'info');
      
      // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø©
      setTimeout(() => {
        allFiles.forEach(file => {
          const fileType = getFileType(file.type, file.name);
          if (fileType === 'archive') {
            console.log('Archive file detected:', file.name);
          }
        });
      }, 1000);
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function loadFiles() {
      try {
        allFiles = await getAllFiles();
        filteredFiles = [...allFiles];
        updateStats();
        filterFiles(currentFilter);
      } catch (error) {
        showMessage('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª', 'error');
      }
    }
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await initDB();
        await loadFiles();
        showMessage('âœ… Ù…Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¬Ø§Ù‡Ø²', 'success');
      } catch (error) {
        showMessage('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
        console.error('App initialization error:', error);
      }
    });
  </script>
</body>
</html>