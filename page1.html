<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>الصفحة 1</title>
<style>
  :root {
    --bg: #0f172a;
    --card: #111827;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --accent: #22c55e;
    --accent-2: #3b82f6;
    --btn-bg: #1f2937;
    --btn-hover: #374151;
    --shadow: 0 10px 25px rgba(0,0,0,.35);
    --radius: 18px;
    --danger: #ef4444;
    --danger-hover: #dc2626;
  }
  * { box-sizing: border-box; }
  html, body {
    margin: 0; padding: 0; background: var(--bg); color: var(--text);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Naskh Arabic", Arial, sans-serif;
  }
  .wrap { min-height: 100vh; display: grid; place-items: center; padding: 24px; }
  .card {
    width: min(920px, 96vw); background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius); padding: 28px; box-shadow: var(--shadow);
    backdrop-filter: blur(6px);
  }
  h1 { margin: 0 0 10px; font-size: clamp(26px, 3.5vw, 40px); letter-spacing: .2px; }
  p.lead { margin: 0 0 26px; color: var(--muted); }
  .grid {
    display: grid; gap: 14px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }
  a.btn, button.btn {
    display: inline-block; text-decoration: none; text-align: center; cursor: pointer;
    background: var(--btn-bg); color: var(--text); padding: 14px 16px;
    border-radius: 14px; border: 1px solid rgba(255,255,255,.08);
    transition: transform .12s ease, background .12s ease, border-color .12s ease;
    box-shadow: 0 6px 14px rgba(0,0,0,.25);
    font-family: inherit; font-size: inherit;
  }
  a.btn:hover, button.btn:hover { background: var(--btn-hover); transform: translateY(-1px); }
  a.btn.primary, button.btn.primary { background: var(--accent-2); border-color: transparent; color: #fff; }
  .btn.success { background: var(--accent); border-color: transparent; color: #fff; }
  .btn.danger { background: var(--danger); border-color: transparent; color: #fff; }
  .btn.danger:hover { background: var(--danger-hover); }
  
  .upload-section {
    margin: 24px 0;
    padding: 24px;
    border: 2px dashed rgba(255,255,255,.1);
    border-radius: var(--radius);
    text-align: center;
    transition: border-color .3s ease, background-color .3s ease;
  }
  .upload-section.dragover {
    border-color: var(--accent-2);
    background: rgba(59, 130, 246, .05);
  }
  
  .config-section {
    margin: 24px 0;
    padding: 20px;
    background: rgba(255,255,255,.02);
    border-radius: var(--radius);
  }
  
  input[type="file"] {
    width: 100%;
    padding: 12px;
    background: var(--btn-bg);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: 10px;
    color: var(--text);
  }
  
  .files-list {
    margin: 24px 0;
  }
  
  .file-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    background: rgba(255,255,255,.02);
    border-radius: 10px;
    margin-bottom: 8px;
  }
  
  .file-info {
    flex: 1;
  }
  
  .file-name {
    font-weight: 500;
    color: var(--text);
  }
  
  .file-size {
    font-size: 12px;
    color: var(--muted);
  }
  
  .file-actions {
    display: flex;
    gap: 8px;
  }
  
  .btn-small {
    padding: 6px 12px;
    font-size: 12px;
  }
  
  .status-message {
    margin: 16px 0;
    padding: 12px;
    border-radius: 10px;
    text-align: center;
  }
  
  .status-success {
    background: rgba(34, 197, 94, .1);
    color: var(--accent);
    border: 1px solid rgba(34, 197, 94, .2);
  }
  
  .status-error {
    background: rgba(239, 68, 68, .1);
    color: var(--danger);
    border: 1px solid rgba(239, 68, 68, .2);
  }
  
  .status-info {
    background: rgba(59, 130, 246, .1);
    color: var(--accent-2);
    border: 1px solid rgba(59, 130, 246, .2);
  }
  
  .hidden {
    display: none;
  }
  
  .progress {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,.1);
    border-radius: 3px;
    overflow: hidden;
    margin: 8px 0;
  }
  
  .progress-bar {
    height: 100%;
    background: var(--accent-2);
    width: 0%;
    transition: width .3s ease;
  }
  
  .connection-ok {
    background: rgba(34, 197, 94, .1);
    color: var(--accent);
    border: 1px solid rgba(34, 197, 94, .2);
    padding: 16px;
    border-radius: 10px;
    text-align: center;
  }
  
  .file-preview {
    max-width: 60px;
    max-height: 60px;
    border-radius: 6px;
    margin-left: 12px;
  }
  
  .file-item-content {
    display: flex;
    align-items: center;
    flex: 1;
  }
  
  footer { margin-top: 18px; color: var(--muted); font-size: 13px; }
</style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>الصفحة 1</h1>
      <p class="lead">هذه صفحة الصفحة 1.</p>
      
      <!-- معلومات الخدمة -->
      <div class="config-section">
        <h3>مركز الملفات المحلي</h3>
        <div class="connection-ok">
          <strong>✅ جاهز للاستخدام</strong>
          <br><small>تخزين محلي آمن - يعمل بدون إنترنت</small>
        </div>
      </div>
      
      <!-- منطقة الرفع -->
      <div class="upload-section" id="upload-area">
        <h3>إضافة الملفات</h3>
        <p>اسحب الملفات هنا أو اختر من الجهاز</p>
        <input type="file" id="file-input" multiple accept="*/*" style="margin: 16px 0;">
        <button class="btn primary" onclick="addFiles()">إضافة الملفات</button>
        <div class="progress hidden" id="upload-progress">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>
      
      <!-- رسائل الحالة -->
      <div id="status-message" class="hidden"></div>
      
      <!-- قائمة الملفات -->
      <div class="files-list">
        <h3>ملفاتي (<span id="files-count">0</span>)</h3>
        <div style="margin-bottom: 16px;">
          <button class="btn" onclick="refreshFiles()">🔄 تحديث</button>
          <button class="btn danger" onclick="clearAllFiles()">🗑️ مسح الكل</button>
          <button class="btn success" onclick="exportFiles()">📦 تصدير الكل</button>
        </div>
        <div id="files-container">
          <!-- سيتم إدراج الملفات هنا -->
        </div>
      </div>
      
      <a class="btn primary" href="index.html">العودة للصفحة الرئيسية</a>
      
      <footer>
        <p>💾 <strong>تخزين محلي:</strong> ملفاتك محفوظة في متصفحك بأمان</p>
      </footer>
    </div>
  </div>

  <script>
    // مخزن الملفات المحلي
    const DB_NAME = 'FilesStorage';
    const DB_VERSION = 1;
    const STORE_NAME = 'files';
    
    let db;
    
    // تهيئة قاعدة البيانات المحلية
    function initDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          db = request.result;
          resolve(db);
        };
        
        request.onupgradeneeded = (event) => {
          db = event.target.result;
          if (!db.objectStoreNames.contains(STORE_NAME)) {
            const store = db.createObjectStore(STORE_NAME, { keyPath: 'id' });
            store.createIndex('name', 'name', { unique: false });
            store.createIndex('uploadTime', 'uploadTime', { unique: false });
          }
        };
      });
    }
    
    // حفظ ملف في قاعدة البيانات
    function saveFile(fileData) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.add(fileData);
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }
    
    // قراءة جميع الملفات
    function getAllFiles() {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readonly');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.getAll();
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }
    
    // حذف ملف
    function deleteFile(id) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.delete(id);
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }
    
    // مسح جميع الملفات
    function clearAllFilesFromDB() {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.clear();
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }
    
    // عرض رسالة الحالة
    function showMessage(message, type) {
      const statusDiv = document.getElementById('status-message');
      statusDiv.textContent = message;
      statusDiv.className = `status-message status-${type}`;
      statusDiv.classList.remove('hidden');
      
      setTimeout(() => {
        statusDiv.classList.add('hidden');
      }, 4000);
    }
    
    // تحويل ملف إلى Base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    // إضافة الملفات
    async function addFiles() {
      const fileInput = document.getElementById('file-input');
      const files = fileInput.files;
      
      if (files.length === 0) {
        showMessage('⚠️ يرجى اختيار ملف واحد على الأقل', 'error');
        return;
      }
      
      const progressDiv = document.getElementById('upload-progress');
      const progressBar = document.getElementById('progress-bar');
      
      progressDiv.classList.remove('hidden');
      showMessage('📁 بدء إضافة الملفات...', 'info');
      
      let successCount = 0;
      let failCount = 0;
      
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const progress = ((i + 1) / files.length) * 100;
        progressBar.style.width = progress + '%';
        
        try {
          const base64Data = await fileToBase64(file);
          const fileData = {
            id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            name: file.name,
            size: file.size,
            type: file.type,
            data: base64Data,
            uploadTime: new Date().toLocaleString('ar-SA'),
            timestamp: Date.now()
          };
          
          await saveFile(fileData);
          successCount++;
        } catch (error) {
          failCount++;
          console.error(`فشل حفظ ${file.name}:`, error);
        }
      }
      
      progressDiv.classList.add('hidden');
      progressBar.style.width = '0%';
      
      if (successCount > 0 && failCount === 0) {
        showMessage(`✅ تم حفظ ${successCount} ملف بنجاح`, 'success');
      } else if (successCount > 0 && failCount > 0) {
        showMessage(`⚠️ تم حفظ ${successCount} ملف، فشل حفظ ${failCount} ملف`, 'error');
      } else {
        showMessage('❌ فشل حفظ جميع الملفات', 'error');
      }
      
      fileInput.value = '';
      await displayFiles();
    }
    
    // عرض قائمة الملفات
    async function displayFiles() {
      try {
        const files = await getAllFiles();
        const container = document.getElementById('files-container');
        const countSpan = document.getElementById('files-count');
        
        countSpan.textContent = files.length;
        
        if (files.length === 0) {
          container.innerHTML = '<p style="color: var(--muted); text-align: center;">📂 لا توجد ملفات محفوظة</p>';
          return;
        }
        
        const sortedFiles = files.sort((a, b) => b.timestamp - a.timestamp);
        
        const fileItems = sortedFiles.map(file => {
          const sizeKB = Math.round(file.size / 1024);
          const isImage = file.type.startsWith('image/');
          
          let preview = '';
          if (isImage) {
            preview = `<img src="${file.data}" class="file-preview" alt="معاينة">`;
          }
          
          return `
            <div class="file-item">
              <div class="file-item-content">
                ${preview}
                <div class="file-info">
                  <div class="file-name">📄 ${file.name}</div>
                  <div class="file-size">${sizeKB} KB - ${file.uploadTime}</div>
                </div>
              </div>
              <div class="file-actions">
                <button class="btn btn-small" onclick="downloadFile('${file.id}')">⬇️ تحميل</button>
                <button class="btn btn-small" onclick="viewFile('${file.id}')">👁️ عرض</button>
                <button class="btn danger btn-small" onclick="removeFile('${file.id}')">🗑️ حذف</button>
              </div>
            </div>
          `;
        }).join('');
        
        container.innerHTML = fileItems;
      } catch (error) {
        showMessage('❌ خطأ في عرض الملفات', 'error');
        console.error('Error displaying files:', error);
      }
    }
    
    // تحميل ملف
    async function downloadFile(fileId) {
      try {
        const files = await getAllFiles();
        const file = files.find(f => f.id === fileId);
        
        if (!file) {
          showMessage('❌ الملف غير موجود', 'error');
          return;
        }
        
        const a = document.createElement('a');
        a.href = file.data;
        a.download = file.name;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        showMessage(`⬇️ تم تحميل ${file.name}`, 'success');
      } catch (error) {
        showMessage('❌ فشل تحميل الملف', 'error');
      }
    }
    
    // عرض ملف
    async function viewFile(fileId) {
      try {
        const files = await getAllFiles();
        const file = files.find(f => f.id === fileId);
        
        if (!file) {
          showMessage('❌ الملف غير موجود', 'error');
          return;
        }
        
        const newWindow = window.open();
        if (file.type.startsWith('image/')) {
          newWindow.document.write(`
            <img src="${file.data}" style="max-width: 100%; height: auto;" alt="${file.name}">
            <p style="text-align: center; font-family: Arial;">${file.name}</p>
          `);
        } else if (file.type === 'application/pdf') {
          newWindow.location.href = file.data;
        } else {
          newWindow.location.href = file.data;
        }
      } catch (error) {
        showMessage('❌ فشل عرض الملف', 'error');
      }
    }
    
    // حذف ملف
    async function removeFile(fileId) {
      try {
        const files = await getAllFiles();
        const file = files.find(f => f.id === fileId);
        
        if (!file) {
          showMessage('❌ الملف غير موجود', 'error');
          return;
        }
        
        if (!confirm(`🗑️ هل أنت متأكد من حذف ${file.name}؟`)) {
          return;
        }
        
        await deleteFile(fileId);
        await displayFiles();
        showMessage(`✅ تم حذف ${file.name}`, 'success');
      } catch (error) {
        showMessage('❌ فشل حذف الملف', 'error');
      }
    }
    
    // تحديث قائمة الملفات
    async function refreshFiles() {
      await displayFiles();
      showMessage('🔄 تم تحديث قائمة الملفات', 'info');
    }
    
    // مسح جميع الملفات
    async function clearAllFiles() {
      if (!confirm('🗑️ هل أنت متأكد من حذف جميع الملفات؟ هذا الإجراء لا يمكن التراجع عنه!')) {
        return;
      }
      
      try {
        await clearAllFilesFromDB();
        await displayFiles();
        showMessage('✅ تم حذف جميع الملفات', 'success');
      } catch (error) {
        showMessage('❌ فشل حذف الملفات', 'error');
      }
    }
    
    // تصدير جميع الملفات
    async function exportFiles() {
      try {
        const files = await getAllFiles();
        
        if (files.length === 0) {
          showMessage('⚠️ لا توجد ملفات للتصدير', 'error');
          return;
        }
        
        const exportData = {
          exportDate: new Date().toLocaleString('ar-SA'),
          filesCount: files.length,
          files: files
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const a = document.createElement('a');
        a.href = URL.createObjectURL(dataBlob);
        a.download = `files_backup_${Date.now()}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        showMessage(`📦 تم تصدير ${files.length} ملف`, 'success');
      } catch (error) {
        showMessage('❌ فشل تصدير الملفات', 'error');
      }
    }
    
    // إعداد السحب والإفلات
    function setupDragAndDrop() {
      const uploadArea = document.getElementById('upload-area');
      
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });
      
      uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
      });
      
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        document.getElementById('file-input').files = files;
      });
    }
    
    // تهيئة التطبيق
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await initDB();
        setupDragAndDrop();
        await displayFiles();
        showMessage('✅ مركز الملفات جاهز للاستخدام', 'success');
      } catch (error) {
        showMessage('❌ خطأ في تهيئة التطبيق', 'error');
        console.error('App initialization error:', error);
      }
    });
  </script>
</body>
</html>